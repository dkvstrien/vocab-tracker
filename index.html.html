<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>German Vocabulary Tracker</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide-react@latest/dist/umd/lucide-react.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom scrollbar styles for better mobile experience */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        
        /* Prevent text selection on UI elements */
        .no-select {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, createElement } = React;
        const { 
            Upload, BookOpen, TrendingUp, Check, X, Eye, Book, MousePointer, 
            Library, Download, FileUp, Trash2, Moon, Sun, Maximize, Minimize, 
            ChevronLeft, ChevronRight, Target, RotateCcw 
        } = LucideReact;

        const GermanVocabTracker = () => {
            const [vocabulary, setVocabulary] = useState(new Map());
            const [currentText, setCurrentText] = useState('');
            const [currentTextTitle, setCurrentTextTitle] = useState('');
            const [currentTextId, setCurrentTextId] = useState('');
            const [analysis, setAnalysis] = useState(null);
            const [activeTab, setActiveTab] = useState('upload');
            const [exposureCount, setExposureCount] = useState(new Map());
            const [lookupHistory, setLookupHistory] = useState(new Map());
            const [selectedWord, setSelectedWord] = useState(null);
            const [textLibrary, setTextLibrary] = useState(new Map());
            const [readingProgress, setReadingProgress] = useState(new Map());
            const [readCounts, setReadCounts] = useState(new Map());
            const [readingGoals, setReadingGoals] = useState(new Map());
            const [darkMode, setDarkMode] = useState(false);
            const [fullScreenReading, setFullScreenReading] = useState(false);
            const [currentPage, setCurrentPage] = useState(0);
            const [wordsPerPage] = useState(200);

            // Word levels: 0 = unknown, 1 = learning, 2 = known
            const levelColors = {
                0: 'bg-red-100 text-red-800 border-red-200',
                1: 'bg-yellow-100 text-yellow-800 border-yellow-200', 
                2: 'bg-green-100 text-green-800 border-green-200'
            };

            const levelLabels = {
                0: 'New',
                1: 'Learning', 
                2: 'Known'
            };

            // Initialize with some common German words and load saved data
            useEffect(() => {
                const commonWords = new Map([
                    ['der', 2], ['die', 2], ['das', 2], ['und', 2], ['ich', 2], ['du', 2], 
                    ['er', 2], ['sie', 2], ['es', 2], ['wir', 2], ['ihr', 2], ['ist', 2],
                    ['sind', 2], ['haben', 2], ['hatte', 2], ['war', 2], ['waren', 2],
                    ['ein', 2], ['eine', 2], ['einen', 2], ['einer', 2], ['mit', 2], 
                    ['zu', 2], ['in', 2], ['auf', 2], ['von', 2], ['fÃ¼r', 2], ['nicht', 2],
                    ['aber', 2], ['auch', 2], ['nur', 2], ['noch', 2], ['schon', 2],
                    ['kann', 2], ['will', 2], ['soll', 2], ['muss', 2], ['darf', 2]
                ]);
                
                // Load saved data
                const savedVocab = localStorage.getItem('germanVocab');
                const savedExposure = localStorage.getItem('exposureCount');
                const savedLookups = localStorage.getItem('lookupHistory');
                const savedLibrary = localStorage.getItem('textLibrary');
                const savedProgress = localStorage.getItem('readingProgress');
                const savedReadCounts = localStorage.getItem('readCounts');
                const savedGoals = localStorage.getItem('readingGoals');
                const savedDarkMode = localStorage.getItem('darkMode');
                
                if (savedVocab) {
                    const vocabMap = new Map(JSON.parse(savedVocab));
                    commonWords.forEach((level, word) => {
                        if (!vocabMap.has(word)) {
                            vocabMap.set(word, level);
                        }
                    });
                    setVocabulary(vocabMap);
                } else {
                    setVocabulary(commonWords);
                }
                
                if (savedExposure) {
                    setExposureCount(new Map(JSON.parse(savedExposure)));
                }
                
                if (savedLookups) {
                    setLookupHistory(new Map(JSON.parse(savedLookups)));
                }
                
                if (savedLibrary) {
                    setTextLibrary(new Map(JSON.parse(savedLibrary)));
                }
                
                if (savedProgress) {
                    setReadingProgress(new Map(JSON.parse(savedProgress)));
                }
                
                if (savedReadCounts) {
                    setReadCounts(new Map(JSON.parse(savedReadCounts)));
                }
                
                if (savedGoals) {
                    setReadingGoals(new Map(JSON.parse(savedGoals)));
                }
                
                if (savedDarkMode) {
                    setDarkMode(JSON.parse(savedDarkMode));
                }
            }, []);

            // Save data whenever it changes
            useEffect(() => {
                localStorage.setItem('germanVocab', JSON.stringify([...vocabulary]));
            }, [vocabulary]);

            useEffect(() => {
                localStorage.setItem('exposureCount', JSON.stringify([...exposureCount]));
            }, [exposureCount]);

            useEffect(() => {
                localStorage.setItem('lookupHistory', JSON.stringify([...lookupHistory]));
            }, [lookupHistory]);

            useEffect(() => {
                localStorage.setItem('textLibrary', JSON.stringify([...textLibrary]));
            }, [textLibrary]);

            useEffect(() => {
                localStorage.setItem('readingProgress', JSON.stringify([...readingProgress]));
            }, [readingProgress]);

            useEffect(() => {
                localStorage.setItem('readCounts', JSON.stringify([...readCounts]));
            }, [readCounts]);

            useEffect(() => {
                localStorage.setItem('readingGoals', JSON.stringify([...readingGoals]));
            }, [readingGoals]);

            useEffect(() => {
                localStorage.setItem('darkMode', JSON.stringify(darkMode));
            }, [darkMode]);

            const cleanWord = (word) => {
                return word.toLowerCase()
                    .replace(/[.,!?;:"()[\]{}â€”â€“-]/g, '')
                    .replace(/[0-9]/g, '')
                    .trim();
            };

            const analyzeText = (text) => {
                const words = text.split(/\s+/)
                    .map(cleanWord)
                    .filter(word => word.length > 0);
                
                const uniqueWords = [...new Set(words)];
                const wordStats = {
                    total: words.length,
                    unique: uniqueWords.length,
                    known: 0,
                    learning: 0,
                    new: 0,
                    wordDetails: []
                };

                uniqueWords.forEach(word => {
                    const level = vocabulary.get(word) ?? 0;
                    const count = words.filter(w => w === word).length;
                    
                    wordStats.wordDetails.push({ word, level, count });
                    
                    if (level === 2) wordStats.known++;
                    else if (level === 1) wordStats.learning++;
                    else wordStats.new++;
                });

                wordStats.wordDetails.sort((a, b) => {
                    if (a.level !== b.level) return a.level - b.level;
                    return b.count - a.count;
                });

                return wordStats;
            };

            const extractTextFromEpub = (arrayBuffer) => {
                try {
                    const decoder = new TextDecoder('utf-8');
                    const text = decoder.decode(arrayBuffer);
                    return text.replace(/<[^>]*>/g, ' ')
                              .replace(/\s+/g, ' ')
                              .trim();
                } catch (error) {
                    return 'Error reading ePub file. Please try converting to .txt format.';
                }
            };

            const handleTextUpload = (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        let text = e.target.result;
                        let title = file.name;
                        
                        if (file.name.toLowerCase().endsWith('.epub')) {
                            text = extractTextFromEpub(text);
                            title = file.name.replace('.epub', '');
                        }
                        
                        text = text.replace(/\r\n/g, '\n').replace(/\r/g, '\n');
                        
                        const textId = Date.now().toString();
                        const newLibrary = new Map(textLibrary);
                        newLibrary.set(textId, {
                            title: title,
                            content: text,
                            dateAdded: new Date().toISOString(),
                            wordCount: text.split(/\s+/).length
                        });
                        setTextLibrary(newLibrary);
                        
                        setCurrentText(text);
                        setCurrentTextTitle(title);
                        setCurrentTextId(textId);
                        setCurrentPage(0);
                        setAnalysis(analyzeText(text));
                        setActiveTab('upload');
                    };
                    
                    if (file.name.toLowerCase().endsWith('.epub')) {
                        reader.readAsArrayBuffer(file);
                    } else {
                        reader.readAsText(file, 'UTF-8');
                    }
                }
            };

            const handleTextPaste = (event) => {
                const text = event.target.value;
                setCurrentText(text);
                if (text.trim()) {
                    setAnalysis(analyzeText(text));
                } else {
                    setAnalysis(null);
                }
            };

            const updateWordLevel = (word, newLevel) => {
                const newVocab = new Map(vocabulary);
                if (newLevel === 0) {
                    newVocab.delete(word);
                } else {
                    newVocab.set(word, newLevel);
                }
                setVocabulary(newVocab);
                
                if (currentText) {
                    setAnalysis(analyzeText(currentText));
                }
            };

            const getPercentageKnown = () => {
                if (!analysis) return 0;
                return Math.round(((analysis.known + analysis.learning * 0.5) / analysis.unique) * 100);
            };

            const addCustomWord = (word, level) => {
                const cleanedWord = cleanWord(word);
                if (cleanedWord) {
                    const newVocab = new Map(vocabulary);
                    newVocab.set(cleanedWord, level);
                    setVocabulary(newVocab);
                }
            };

            const loadTextFromLibrary = (textId) => {
                const textData = textLibrary.get(textId);
                if (textData) {
                    setCurrentText(textData.content);
                    setCurrentTextTitle(textData.title);
                    setCurrentTextId(textId);
                    setCurrentPage(0);
                    setAnalysis(analyzeText(textData.content));
                }
            };

            const deleteTextFromLibrary = (textId) => {
                const newLibrary = new Map(textLibrary);
                newLibrary.delete(textId);
                setTextLibrary(newLibrary);
                
                const textData = textLibrary.get(textId);
                if (textData && currentTextTitle === textData.title) {
                    setCurrentText('');
                    setCurrentTextTitle('');
                    setCurrentTextId('');
                    setAnalysis(null);
                }
            };

            const setReadingGoal = (textId, goal) => {
                const newGoals = new Map(readingGoals);
                newGoals.set(textId, parseInt(goal));
                setReadingGoals(newGoals);
            };

            const markTextAsRead = (textId) => {
                const newReadCounts = new Map(readCounts);
                const currentCount = newReadCounts.get(textId) || 0;
                newReadCounts.set(textId, currentCount + 1);
                setReadCounts(newReadCounts);
            };

            const getTextPages = () => {
                if (!currentText) return [];
                const words = currentText.split(/\s+/);
                const pages = [];
                
                for (let i = 0; i < words.length; i += wordsPerPage) {
                    const pageWords = words.slice(i, i + wordsPerPage);
                    pages.push(pageWords.join(' '));
                }
                
                return pages;
            };

            const getCurrentPageText = () => {
                const pages = getTextPages();
                return pages[currentPage] || '';
            };

            const getTotalPages = () => {
                return getTextPages().length;
            };

            const getReadingProgress = () => {
                const totalPages = getTotalPages();
                if (totalPages === 0) return 0;
                return Math.round(((currentPage + 1) / totalPages) * 100);
            };

            const nextPage = () => {
                const totalPages = getTotalPages();
                if (currentPage < totalPages - 1) {
                    setCurrentPage(currentPage + 1);
                    
                    if (currentTextId) {
                        const newProgress = new Map(readingProgress);
                        newProgress.set(currentTextId, (currentPage + 1) / totalPages);
                        setReadingProgress(newProgress);
                        
                        if (currentPage + 1 === totalPages - 1) {
                            markTextAsRead(currentTextId);
                        }
                    }
                }
            };

            const prevPage = () => {
                if (currentPage > 0) {
                    setCurrentPage(currentPage - 1);
                    
                    if (currentTextId) {
                        const newProgress = new Map(readingProgress);
                        newProgress.set(currentTextId, (currentPage - 1) / getTotalPages());
                        setReadingProgress(newProgress);
                    }
                }
            };

            const goToPage = (pageNum) => {
                const totalPages = getTotalPages();
                const targetPage = Math.max(0, Math.min(pageNum, totalPages - 1));
                setCurrentPage(targetPage);
                
                if (currentTextId) {
                    const newProgress = new Map(readingProgress);
                    newProgress.set(currentTextId, targetPage / totalPages);
                    setReadingProgress(newProgress);
                }
            };

            const handleWordClick = (word) => {
                const cleanedWord = cleanWord(word);
                if (!cleanedWord) return;

                setSelectedWord(cleanedWord);
                
                const newLookupHistory = new Map(lookupHistory);
                const currentLookups = newLookupHistory.get(cleanedWord) || 0;
                newLookupHistory.set(cleanedWord, currentLookups + 1);
                setLookupHistory(newLookupHistory);
                
                if (!vocabulary.has(cleanedWord)) {
                    const newVocab = new Map(vocabulary);
                    newVocab.set(cleanedWord, 0);
                    setVocabulary(newVocab);
                }
            };

            const trackExposure = (wordsInText) => {
                const newExposure = new Map(exposureCount);
                const cleanedWords = wordsInText
                    .split(/\s+/)
                    .map(cleanWord)
                    .filter(word => word.length > 0);

                cleanedWords.forEach(word => {
                    const currentExposure = newExposure.get(word) || 0;
                    newExposure.set(word, currentExposure + 1);
                });
                
                setExposureCount(newExposure);
            };

            const getWordStats = (word) => {
                const level = vocabulary.get(word) || 0;
                const exposures = exposureCount.get(word) || 0;
                const lookups = lookupHistory.get(word) || 0;
                return { level, exposures, lookups };
            };

            const renderReadingText = () => {
                const textToRender = fullScreenReading ? getCurrentPageText() : currentText;
                if (!textToRender) return null;
                
                const words = textToRender.split(/(\s+)/);
                
                return words.map((segment, index) => {
                    if (/\s/.test(segment)) {
                        return createElement('span', { key: index }, segment);
                    }
                    
                    const cleanedWord = cleanWord(segment);
                    const wordStats = getWordStats(cleanedWord);
                    const isSelected = selectedWord === cleanedWord;
                    
                    let className = 'cursor-pointer hover:bg-blue-100 px-1 py-0.5 rounded transition-colors touch-manipulation ';
                    
                    if (darkMode) {
                        className = className.replace('hover:bg-blue-100', 'hover:bg-blue-800');
                    }
                    
                    if (cleanedWord) {
                        if (wordStats.level === 2) {
                            className += darkMode ? 'bg-green-900 text-green-300 ' : 'bg-green-50 text-green-800 ';
                        } else if (wordStats.level === 1) {
                            className += darkMode ? 'bg-yellow-900 text-yellow-300 ' : 'bg-yellow-50 text-yellow-800 ';
                        } else if (wordStats.lookups > 0) {
                            className += darkMode ? 'bg-red-900 text-red-300 ' : 'bg-red-50 text-red-800 ';
                        } else {
                            className += darkMode ? 'hover:bg-gray-700 ' : 'hover:bg-gray-100 ';
                        }
                        
                        if (isSelected) {
                            className += darkMode ? 'ring-2 ring-blue-400 bg-blue-800 ' : 'ring-2 ring-blue-500 bg-blue-100 ';
                        }
                    }
                    
                    return createElement('span', {
                        key: index,
                        className: className,
                        onClick: () => cleanedWord && handleWordClick(cleanedWord),
                        style: { 
                            minHeight: '28px', 
                            display: 'inline-block',
                            touchAction: 'manipulation'
                        },
                        title: cleanedWord ? `Level: ${levelLabels[wordStats.level]}, Seen: ${wordStats.exposures}x, Looked up: ${wordStats.lookups}x` : ''
                    }, segment);
                });
            };

            const germanDictionary = {
                'hallo': 'hello',
                'welt': 'world',
                'haus': 'house',
                'katze': 'cat',
                'hund': 'dog',
                'wasser': 'water',
                'essen': 'to eat / food',
                'trinken': 'to drink',
                'gehen': 'to go',
                'kommen': 'to come',
                'sehen': 'to see',
                'hÃ¶ren': 'to hear',
                'sprechen': 'to speak',
                'lieben': 'to love',
                'leben': 'to live',
                'arbeiten': 'to work',
                'schlafen': 'to sleep',
                'lesen': 'to read',
                'schreiben': 'to write',
                'lernen': 'to learn',
                'verstehen': 'to understand',
                'heute': 'today',
                'gestern': 'yesterday',
                'morgen': 'tomorrow',
                'zeit': 'time',
                'jahr': 'year',
                'tag': 'day',
                'nacht': 'night',
                'abend': 'evening',
                'klein': 'small',
                'groÃŸ': 'big',
                'gut': 'good',
                'schlecht': 'bad',
                'neu': 'new',
                'alt': 'old',
                'schnell': 'fast',
                'langsam': 'slow'
            };

            const getTranslation = (word) => {
                return germanDictionary[word.toLowerCase()] || 'Translation not available';
            };

            useEffect(() => {
                if (currentText && activeTab === 'reading') {
                    trackExposure(currentText);
                }
            }, [currentText, activeTab]);

            const exportData = () => {
                const exportData = {
                    vocabulary: [...vocabulary],
                    exposureCount: [...exposureCount],
                    lookupHistory: [...lookupHistory],
                    textLibrary: [...textLibrary],
                    readingProgress: [...readingProgress],
                    readCounts: [...readCounts],
                    readingGoals: [...readingGoals],
                    darkMode: darkMode,
                    exportDate: new Date().toISOString()
                };
                
                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `german-vocab-backup-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
            };

            const importData = (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const importedData = JSON.parse(e.target.result);
                            
                            if (importedData.vocabulary) {
                                setVocabulary(new Map(importedData.vocabulary));
                            }
                            if (importedData.exposureCount) {
                                setExposureCount(new Map(importedData.exposureCount));
                            }
                            if (importedData.lookupHistory) {
                                setLookupHistory(new Map(importedData.lookupHistory));
                            }
                            if (importedData.textLibrary) {
                                setTextLibrary(new Map(importedData.textLibrary));
                            }
                            if (importedData.readingProgress) {
                                setReadingProgress(new Map(importedData.readingProgress));
                            }
                            if (importedData.readCounts) {
                                setReadCounts(new Map(importedData.readCounts));
                            }
                            if (importedData.readingGoals) {
                                setReadingGoals(new Map(importedData.readingGoals));
                            }
                            if (importedData.darkMode !== undefined) {
                                setDarkMode(importedData.darkMode);
                            }
                            
                            alert('Data imported successfully!');
                        } catch (error) {
                            alert('Error importing data. Please check the file format.');
                        }
                    };
                    reader.readAsText(file);
                }
            };

            if (fullScreenReading && currentText) {
                return createElement('div', {
                    className: `fixed inset-0 z-50 flex flex-col ${
                        darkMode ? 'bg-gray-900 text-gray-200' : 'bg-white text-gray-900'
                    }`
                },
                    // Header
                    createElement('div', {
                        className: `flex items-center justify-between p-4 border-b ${
                            darkMode ? 'border-gray-700 bg-gray-800' : 'border-gray-200 bg-gray-50'
                        }`
                    },
                        createElement('div', { className: 'flex items-center gap-3' },
                            createElement('button', {
                                onClick: () => setFullScreenReading(false),
                                className: `p-2 rounded-lg transition-colors ${
                                    darkMode ? 'hover:bg-gray-700' : 'hover:bg-gray-200'
                                }`
                            }, createElement(Minimize, { className: 'w-5 h-5' })),
                            createElement('div', {},
                                createElement('h3', { className: 'font-medium truncate max-w-xs' }, currentTextTitle),
                                createElement('div', { className: 'text-sm opacity-75' }, `Page ${currentPage + 1} of ${getTotalPages()}`)
                            )
                        ),
                        createElement('div', { className: 'flex items-center gap-2' },
                            createElement('button', {
                                onClick: () => setDarkMode(!darkMode),
                                className: `p-2 rounded-lg transition-colors ${
                                    darkMode ? 'hover:bg-gray-700' : 'hover:bg-gray-200'
                                }`
                            }, darkMode ? createElement(Sun, { className: 'w-5 h-5' }) : createElement(Moon, { className: 'w-5 h-5' }))
                        )
                    ),

                    // Progress Bar
                    createElement('div', { className: `h-1 ${darkMode ? 'bg-gray-800' : 'bg-gray-200'}` },
                        createElement('div', {
                            className: 'h-full bg-blue-500 transition-all duration-300',
                            style: { width: `${getReadingProgress()}%` }
                        })
                    ),

                    // Reading Area
                    createElement('div', { className: 'flex-1 flex' },
                        createElement('div', { className: 'flex-1 p-6 overflow-hidden' },
                            createElement('div', { className: 'max-w-4xl mx-auto h-full flex flex-col justify-center' },
                                createElement('div', {
                                    className: 'text-xl leading-relaxed text-justify select-text',
                                    style: { 
                                        lineHeight: '1.8',
                                        fontSize: '1.25rem',
                                        fontFamily: 'Georgia, serif'
                                    }
                                }, renderReadingText())
                            )
                        ),

                        // Word Lookup Sidebar
                        selectedWord && createElement('div', {
                            className: `w-80 border-l p-6 ${
                                darkMode ? 'border-gray-700 bg-gray-800' : 'border-gray-200 bg-gray-50'
                            }`
                        },
                            createElement('div', { className: 'sticky top-6' },
                                createElement('h3', { className: 'font-semibold text-lg mb-4' }, 'Word Lookup'),
                                createElement('div', { className: 'space-y-4' },
                                    createElement('div', {},
                                        createElement('div', { className: 'text-3xl font-bold text-blue-600 mb-3' }, selectedWord),
                                        createElement('div', {
                                            className: `text-lg mb-4 ${
                                                darkMode ? 'text-gray-300' : 'text-gray-700'
                                            }`
                                        }, getTranslation(selectedWord))
                                    ),
                                    createElement('div', { className: 'space-y-3 text-sm' },
                                        createElement('div', { className: 'flex justify-between' },
                                            createElement('span', { className: darkMode ? 'text-gray-400' : 'text-gray-600' }, 'Current Level:'),
                                            createElement('span', {
                                                className: `px-3 py-1 rounded-full text-xs ${levelColors[getWordStats(selectedWord).level]}`
                                            }, levelLabels[getWordStats(selectedWord).level])
                                        ),
                                        createElement('div', { className: 'flex justify-between' },
                                            createElement('span', { className: darkMode ? 'text-gray-400' : 'text-gray-600' }, 'Times Seen:'),
                                            createElement('span', { className: 'font-medium' }, getWordStats(selectedWord).exposures)
                                        ),
                                        createElement('div', { className: 'flex justify-between' },
                                            createElement('span', { className: darkMode ? 'text-gray-400' : 'text-gray-600' }, 'Times Looked Up:'),
                                            createElement('span', { className: 'font-medium' }, getWordStats(selectedWord).lookups)
                                        )
                                    ),
                                    createElement('div', { className: 'flex flex-col gap-3 pt-4 border-t' },
                                        createElement('button', {
                                            onClick: () => updateWordLevel(selectedWord, 1),
                                            className: 'w-full bg-yellow-100 text-yellow-800 py-3 px-4 rounded-lg text-sm font-medium hover:bg-yellow-200 transition-colors'
                                        }, 'ðŸ“ Mark as Learning'),
                                        createElement('button', {
                                            onClick: () => updateWordLevel(selectedWord, 2),
                                            className: 'w-full bg-green-100 text-green-800 py-3 px-4 rounded-lg text-sm font-medium hover:bg-green-200 transition-colors'
                                        }, 'âœ… Mark as Known'),
                                        createElement('button', {
                                            onClick: () => setSelectedWord(null),
                                            className: `w-full py-2 px-4 rounded-lg text-sm transition-colors ${
                                                darkMode ? 'bg-gray-700 text-gray-300 hover:bg-gray-600' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                            }`
                                        }, 'Close')
                                    )
                                )
                            )
                        )
                    ),

                    // Footer Navigation
                    createElement('div', {
                        className: `flex items-center justify-between p-4 border-t ${
                            darkMode ? 'border-gray-700 bg-gray-800' : 'border-gray-200 bg-gray-50'
                        }`
                    },
                        createElement('button', {
                            onClick: prevPage,
                            disabled: currentPage === 0,
                            className: `flex items-center gap-2 px-6 py-3 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed ${
                                darkMode 
                                    ? 'bg-gray-700 text-gray-300 hover:bg-gray-600' 
                                    : 'bg-white border text-gray-700 hover:bg-gray-50'
                            }`
                        },
                            createElement(ChevronLeft, { className: 'w-5 h-5' }),
                            'Previous'
                        ),
                        
                        createElement('div', { className: 'flex items-center gap-4 text-sm' },
                            createElement('div', { className: 'flex items-center gap-2' },
                                createElement('span', {}, 'Page'),
                                createElement('input', {
                                    type: 'number',
                                    min: '1',
                                    max: getTotalPages(),
                                    value: currentPage + 1,
                                    onChange: (e) => goToPage(parseInt(e.target.value) - 1),
                                    className: `w-20 px-3 py-2 border rounded-lg text-center ${
                                        darkMode 
                                            ? 'bg-gray-700 border-gray-600 text-gray-200' 
                                            : 'bg-white border-gray-300'
                                    }`
                                }),
                                createElement('span', {}, `of ${getTotalPages()}`)
                            ),
                            createElement('div', {
                                className: `px-3 py-2 rounded-lg ${
                                    darkMode ? 'bg-gray-700' : 'bg-white border'
                                }`
                            }, `${getReadingProgress()}% complete`)
                        ),
                        
                        createElement('button', {
                            onClick: nextPage,
                            disabled: currentPage >= getTotalPages() - 1,
                            className: `flex items-center gap-2 px-6 py-3 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed ${
                                darkMode 
                                    ? 'bg-gray-700 text-gray-300 hover:bg-gray-600' 
                                    : 'bg-white border text-gray-700 hover:bg-gray-50'
                            }`
                        },
                            'Next',
                            createElement(ChevronRight, { className: 'w-5 h-5' })
                        )
                    )
                );
            }

            return createElement('div', {
                className: `max-w-6xl mx-auto p-3 sm:p-6 min-h-screen ${
                    darkMode ? 'bg-gray-900' : 'bg-gray-50'
                }`
            },
                createElement('div', {
                    className: `rounded-lg shadow-lg overflow-hidden ${
                        darkMode ? 'bg-gray-800' : 'bg-white'
                    }`
                },
                    createElement('div', { className: 'bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4 sm:p-6' },
                        createElement('h1', { className: 'text-2xl sm:text-3xl font-bold flex items-center gap-3' },
                            createElement(BookOpen, { className: 'w-6 h-6 sm:w-8 sm:h-8' }),
                            'German Vocab Tracker'
                        ),
                        createElement('p', { className: 'mt-2 opacity-90 text-sm sm:text-base' },
                            'Upload texts and automatically track your German vocabulary progress'
                        )
                    ),

                    createElement('div', { className: 'border-b border-gray-200' },
                        createElement('nav', { className: 'flex overflow-x-auto' },
                            [
                                { id: 'upload', label: 'Text Analysis', icon: Upload },
                                { id: 'library', label: 'Text Library', icon: Library },
                                { id: 'reading', label: 'Reading Mode', icon: MousePointer },
                                { id: 'vocab', label: 'Vocabulary', icon: Book },
                                { id: 'stats', label: 'Statistics', icon: TrendingUp }
                            ].map(tab => 
                                createElement('button', {
                                    key: tab.id,
                                    onClick: () => setActiveTab(tab.id),
                                    className: `flex items-center gap-2 px-4 py-4 font-medium border-b-2 transition-colors whitespace-nowrap ${
                                        activeTab === tab.id
                                            ? 'border-blue-500 text-blue-600 bg-blue-50'
                                            : 'border-transparent text-gray-500 hover:text-gray-700'
                                    }`
                                },
                                    createElement(tab.icon, { className: 'w-4 h-4' }),
                                    createElement('span', { className: 'hidden sm:inline' }, tab.label)
                                )
                            )
                        )
                    ),

                    createElement('div', { className: 'p-3 sm:p-6' },
                        activeTab === 'upload' && createElement('div', { className: 'space-y-6' },
                            createElement('div', {},
                                createElement('h2', { className: 'text-xl font-semibold mb-4' }, 'Analyze German Text'),
                                createElement('div', { className: 'space-y-4' },
                                    createElement('div', {},
                                        createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-2' }, 'Upload Text File'),
                                        createElement('input', {
                                            type: 'file',
                                            accept: '.txt,.epub,.srt,.vtt,.rtf',
                                            onChange: handleTextUpload,
                                            className: 'block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100'
                                        }),
                                        createElement('p', { className: 'text-xs text-gray-500 mt-1' }, 'Supports: .txt, .epub, .srt (subtitles), .vtt, .rtf')
                                    ),
                                    
                                    createElement('div', { className: 'text-gray-500 text-center' }, 'or'),
                                    
                                    createElement('div', {},
                                        createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-2' }, 'Paste Text'),
                                        createElement('textarea', {
                                            value: currentText,
                                            onChange: handleTextPaste,
                                            placeholder: 'Paste your German text here...',
                                            className: 'w-full h-32 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm'
                                        })
                                    ),

                                    createElement('div', { className: 'flex flex-col sm:flex-row gap-2' },
                                        createElement('button', {
                                            onClick: exportData,
                                            className: 'flex items-center justify-center gap-2 px-4 py-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-colors'
                                        },
                                            createElement(Download, { className: 'w-4 h-4' }),
                                            'Export Data'
                                        ),
                                        createElement('label', { className: 'flex items-center justify-center gap-2 px-4 py-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors cursor-pointer' },
                                            createElement(FileUp, { className: 'w-4 h-4' }),
                                            'Import Data',
                                            createElement('input', {
                                                type: 'file',
                                                accept: '.json',
                                                onChange: importData,
                                                className: 'hidden'
                                            })
                                        )
                                    )
                                )
                            ),

                            analysis && createElement('div', { className: 'bg-gray-50 rounded-lg p-6' },
                                createElement('h3', { className: 'text-lg font-semibold mb-4' }, 'Text Analysis Results'),
                                currentTextTitle && createElement('div', { className: 'mb-4 p-3 bg-blue-50 rounded-lg' },
                                    createElement('h4', { className: 'font-medium text-blue-800' }, `ðŸ“– ${currentTextTitle}`)
                                ),
                                
                                createElement('div', { className: 'grid grid-cols-2 md:grid-cols-4 gap-4 mb-6' },
                                    createElement('div', { className: 'bg-white p-4 rounded-lg text-center' },
                                        createElement('div', { className: 'text-2xl font-bold text-blue-600' }, analysis.total),
                                        createElement('div', { className: 'text-sm text-gray-600' }, 'Total Words')
                                    ),
                                    createElement('div', { className: 'bg-white p-4 rounded-lg text-center' },
                                        createElement('div', { className: 'text-2xl font-bold text-purple-600' }, analysis.unique),
                                        createElement('div', { className: 'text-sm text-gray-600' }, 'Unique Words')
                                    ),
                                    createElement('div', { className: 'bg-white p-4 rounded-lg text-center' },
                                        createElement('div', { className: 'text-2xl font-bold text-green-600' }, `${getPercentageKnown()}%`),
                                        createElement('div', { className: 'text-sm text-gray-600' }, 'Known')
                                    ),
                                    createElement('div', { className: 'bg-white p-4 rounded-lg text-center' },
                                        createElement('div', { className: 'text-2xl font-bold text-red-600' }, analysis.new),
                                        createElement('div', { className: 'text-sm text-gray-600' }, 'New Words')
                                    )
                                ),

                                createElement('div', { className: 'space-y-4' },
                                    [0, 1, 2].map(level => {
                                        const wordsAtLevel = analysis.wordDetails.filter(w => w.level === level);
                                        if (wordsAtLevel.length === 0) return null;
                                        
                                        return createElement('div', { key: level, className: 'bg-white rounded-lg p-4' },
                                            createElement('h4', {
                                                className: `font-medium mb-3 ${levelColors[level]} inline-block px-3 py-1 rounded-full border`
                                            }, `${levelLabels[level]} Words (${wordsAtLevel.length})`),
                                            createElement('div', { className: 'flex flex-wrap gap-2' },
                                                wordsAtLevel.slice(0, 20).map(({ word, count }) =>
                                                    createElement('div', {
                                                        key: word,
                                                        className: `inline-flex items-center gap-2 px-3 py-1 rounded-lg border ${levelColors[level]} text-xs sm:text-sm`
                                                    },
                                                        createElement('span', { className: 'font-medium' }, word),
                                                        createElement('span', { className: 'text-xs opacity-75' }, `(${count}x)`),
                                                        createElement('div', { className: 'flex gap-1' },
                                                            level < 2 && createElement('button', {
                                                                onClick: () => updateWordLevel(word, level + 1),
                                                                className: 'text-green-600 hover:bg-green-100 rounded p-1',
                                                                title: level === 0 ? "Mark as Learning" : "Mark as Known"
                                                            }, createElement(Check, { className: 'w-3 h-3' })),
                                                            level > 0 && createElement('button', {
                                                                onClick: () => updateWordLevel(word, level - 1),
                                                                className: 'text-red-600 hover:bg-red-100 rounded p-1',
                                                                title: level === 2 ? "Mark as Learning" : "Mark as New"
                                                            }, createElement(X, { className: 'w-3 h-3' }))
                                                        )
                                                    )
                                                ),
                                                wordsAtLevel.length > 20 && createElement('div', { className: 'text-sm text-gray-500 italic' },
                                                    `... and ${wordsAtLevel.length - 20} more`
                                                )
                                            )
                                        );
                                    })
                                )
                            )
                        ),

                        activeTab === 'library' && createElement('div', { className: 'space-y-6' },
                            createElement('div', { className: 'flex items-center justify-between' },
                                createElement('h2', { className: 'text-xl font-semibold' }, 'Text Library'),
                                createElement('button', {
                                    onClick: () => setDarkMode(!darkMode),
                                    className: 'flex items-center gap-2 px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors'
                                },
                                    darkMode ? createElement(Sun, { className: 'w-4 h-4' }) : createElement(Moon, { className: 'w-4 h-4' }),
                                    createElement('span', { className: 'text-sm' }, darkMode ? 'Light' : 'Dark', ' Mode')
                                )
                            ),
                            
                            textLibrary.size === 0 ? createElement('div', { className: 'text-center py-12 text-gray-500' },
                                createElement(Library, { className: 'w-16 h-16 mx-auto mb-4 opacity-50' }),
                                createElement('p', { className: 'text-lg mb-2' }, 'No texts in your library yet'),
                                createElement('p', {}, 'Upload texts in the Text Analysis tab to get started')
                            ) : createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4' },
                                Array.from(textLibrary.entries()).map(([textId, textData]) => {
                                    const readCount = readCounts.get(textId) || 0;
                                    const goal = readingGoals.get(textId) || 3;
                                    const progress = readingProgress.get(textId) || 0;
                                    const progressPercent = Math.round(progress * 100);
                                    
                                    return createElement('div', { key: textId, className: 'bg-white border rounded-lg p-4 hover:shadow-lg transition-shadow' },
                                        createElement('div', { className: 'flex justify-between items-start mb-3' },
                                            createElement('h3', { className: 'font-semibold text-gray-800 truncate pr-2' }, textData.title),
                                            createElement('button', {
                                                onClick: () => deleteTextFromLibrary(textId),
                                                className: 'text-red-500 hover:bg-red-50 rounded p-1',
                                                title: 'Delete text'
                                            }, createElement(Trash2, { className: 'w-4 h-4' }))
                                        ),
                                        
                                        createElement('div', { className: 'text-sm text-gray-600 space-y-2 mb-4' },
                                            createElement('div', { className: 'flex items-center gap-2' },
                                                createElement('span', {}, `ðŸ“Š ${textData.wordCount?.toLocaleString()} words`)
                                            ),
                                            createElement('div', { className: 'flex items-center gap-2' },
                                                createElement('span', {}, `ðŸ“… ${new Date(textData.dateAdded).toLocaleDateString()}`)
                                            ),
                                            
                                            createElement('div', { className: 'space-y-1' },
                                                createElement('div', { className: 'flex justify-between text-xs' },
                                                    createElement('span', {}, 'Reading Progress'),
                                                    createElement('span', {}, `${progressPercent}%`)
                                                ),
                                                createElement('div', { className: 'w-full bg-gray-200 rounded-full h-2' },
                                                    createElement('div', {
                                                        className: 'bg-blue-500 h-2 rounded-full transition-all duration-300',
                                                        style: { width: `${progressPercent}%` }
                                                    })
                                                )
                                            ),
                                            
                                            createElement('div', { className: 'flex items-center justify-between' },
                                                createElement('div', { className: 'flex items-center gap-2' },
                                                    createElement(RotateCcw, { className: 'w-3 h-3' }),
                                                    createElement('span', {
                                                        className: `text-sm font-medium ${readCount >= goal ? 'text-green-600' : 'text-orange-600'}`
                                                    }, `${readCount}/${goal} reads`),
                                                    readCount >= goal && createElement('span', { className: 'text-green-500 text-xs' }, 'âœ… Goal reached!')
                                                ),
                                                createElement('div', { className: 'flex items-center gap-1' },
                                                    createElement(Target, { className: 'w-3 h-3 text-gray-400' }),
                                                    createElement('select', {
                                                        value: goal,
                                                        onChange: (e) => setReadingGoal(textId, e.target.value),
                                                        className: 'text-xs border rounded px-1 py-0.5 bg-white'
                                                    },
                                                        [1,2,3,4,5,6,7,8,9,10].map(num => 
                                                            createElement('option', { key: num, value: num }, num)
                                                        )
                                                    )
                                                )
                                            )
                                        ),
                                        
                                        createElement('div', { className: 'flex gap-2' },
                                            createElement('button', {
                                                onClick: () => {
                                                    loadTextFromLibrary(textId);
                                                    setActiveTab('reading');
                                                },
                                                className: 'flex-1 bg-blue-100 text-blue-700 py-2 px-3 rounded text-sm font-medium hover:bg-blue-200 transition-colors flex items-center justify-center gap-1'
                                            },
                                                createElement(BookOpen, { className: 'w-3 h-3' }),
                                                'Read'
                                            ),
                                            createElement('button', {
                                                onClick: () => {
                                                    loadTextFromLibrary(textId);
                                                    setActiveTab('upload');
                                                },
                                                className: 'flex-1 bg-gray-100 text-gray-700 py-2 px-3 rounded text-sm font-medium hover:bg-gray-200 transition-colors flex items-center justify-center gap-1'
                                            },
                                                createElement(TrendingUp, { className: 'w-3 h-3' }),
                                                'Analyze'
                                            )
                                        )
                                    );
                                })
                            )
                        ),

                        activeTab === 'reading' && createElement('div', { className: 'space-y-6' },
                            createElement('div', { className: 'flex items-center justify-between' },
                                createElement('h2', { className: 'text-xl font-semibold' }, 'Reading Mode'),
                                createElement('div', { className: 'flex items-center gap-2' },
                                    createElement('button', {
                                        onClick: () => setDarkMode(!darkMode),
                                        className: 'flex items-center gap-2 px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors'
                                    },
                                        darkMode ? createElement(Sun, { className: 'w-4 h-4' }) : createElement(Moon, { className: 'w-4 h-4' })
                                    ),
                                    currentText && createElement('button', {
                                        onClick: () => setFullScreenReading(true),
                                        className: 'flex items-center gap-2 px-3 py-2 bg-blue-100 text-blue-700 hover:bg-blue-200 rounded-lg transition-colors'
                                    },
                                        createElement(Maximize, { className: 'w-4 h-4' }),
                                        createElement('span', { className: 'hidden sm:inline' }, 'Full Screen')
                                    )
                                )
                            ),

                            !currentText && createElement('div', { className: 'text-center py-12 text-gray-500' },
                                createElement(BookOpen, { className: 'w-16 h-16 mx-auto mb-4 opacity-50' }),
                                createElement('p', { className: 'text-lg mb-2' }, 'No text selected'),
                                createElement('p', {}, 'Choose a text from your library to start reading')
                            ),

                            currentText && createElement('div', { className: 'grid grid-cols-1 lg:grid-cols-3 gap-6' },
                                createElement('div', { className: 'lg:col-span-2' },
                                    currentTextTitle && createElement('div', { className: 'mb-4 p-3 bg-blue-50 rounded-lg' },
                                        createElement('h3', { className: 'font-medium text-blue-800' }, `ðŸ“– ${currentTextTitle}`),
                                        createElement('div', { className: 'text-sm text-blue-600 mt-1' },
                                            `Page ${currentPage + 1} of ${getTotalPages()} â€¢ ${getReadingProgress()}% complete`
                                        )
                                    ),
                                    
                                    createElement('div', {
                                        className: `border rounded-lg p-4 sm:p-6 max-h-96 sm:max-h-[500px] overflow-y-auto ${
                                            darkMode ? 'bg-gray-900 border-gray-700' : 'bg-white'
                                        }`
                                    },
                                        createElement('div', {
                                            className: `leading-relaxed text-base sm:text-lg ${
                                                darkMode ? 'text-gray-200' : 'text-gray-700'
                                            }`,
                                            style: { lineHeight: '1.8' }
                                        }, renderReadingText())
                                    ),
                                    
                                    createElement('div', { className: 'flex items-center justify-between mt-4 p-3 bg-gray-50 rounded-lg' },
                                        createElement('button', {
                                            onClick: prevPage,
                                            disabled: currentPage === 0,
                                            className: 'flex items-center gap-2 px-3 py-2 bg-white border rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50 transition-colors'
                                        },
                                            createElement(ChevronLeft, { className: 'w-4 h-4' }),
                                            createElement('span', { className: 'hidden sm:inline' }, 'Previous')
                                        ),
                                        
                                        createElement('div', { className: 'flex items-center gap-2 text-sm text-gray-600' },
                                            createElement('span', {}, 'Page'),
                                            createElement('input', {
                                                type: 'number',
                                                min: '1',
                                                max: getTotalPages(),
                                                value: currentPage + 1,
                                                onChange: (e) => goToPage(parseInt(e.target.value) - 1),
                                                className: 'w-16 px-2 py-1 border rounded text-center'
                                            }),
                                            createElement('span', {}, `of ${getTotalPages()}`)
                                        ),
                                        
                                        createElement('button', {
                                            onClick: nextPage,
                                            disabled: currentPage >= getTotalPages() - 1,
                                            className: 'flex items-center gap-2 px-3 py-2 bg-white border rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50 transition-colors'
                                        },
                                            createElement('span', { className: 'hidden sm:inline' }, 'Next'),
                                            createElement(ChevronRight, { className: 'w-4 h-4' })
                                        )
                                    )
                                ),

                                createElement('div', { className: 'lg:col-span-1' },
                                    selectedWord ? createElement('div', {
                                        className: `border rounded-lg p-4 sticky top-4 ${
                                            darkMode ? 'bg-gray-900 border-gray-700' : 'bg-white'
                                        }`
                                    },
                                        createElement('h3', {
                                            className: `font-semibold text-lg mb-3 ${
                                                darkMode ? 'text-white' : 'text-gray-900'
                                            }`
                                        }, 'Word Lookup'),
                                        
                                        createElement('div', { className: 'space-y-4' },
                                            createElement('div', {},
                                                createElement('div', { className: 'text-2xl font-bold text-blue-600 mb-2' }, selectedWord),
                                                createElement('div', {
                                                    className: `mb-3 text-sm sm:text-base ${
                                                        darkMode ? 'text-gray-300' : 'text-gray-700'
                                                    }`
                                                }, getTranslation(selectedWord))
                                            ),

                                            createElement('div', { className: 'space-y-2 text-sm' },
                                                createElement('div', { className: 'flex justify-between' },
                                                    createElement('span', { className: darkMode ? 'text-gray-400' : 'text-gray-600' }, 'Current Level:'),
                                                    createElement('span', {
                                                        className: `px-2 py-1 rounded text-xs ${levelColors[getWordStats(selectedWord).level]}`
                                                    }, levelLabels[getWordStats(selectedWord).level])
                                                ),
                                                createElement('div', { className: 'flex justify-between' },
                                                    createElement('span', { className: darkMode ? 'text-gray-400' : 'text-gray-600' }, 'Times Seen:'),
                                                    createElement('span', { className: 'font-medium' }, getWordStats(selectedWord).exposures)
                                                ),
                                                createElement('div', { className: 'flex justify-between' },
                                                    createElement('span', { className: darkMode ? 'text-gray-400' : 'text-gray-600' }, 'Times Looked Up:'),
                                                    createElement('span', { className: 'font-medium' }, getWordStats(selectedWord).lookups)
                                                )
                                            ),

                                            createElement('div', { className: 'flex flex-col sm:flex-row gap-2 pt-3 border-t' },
                                                createElement('button', {
                                                    onClick: () => updateWordLevel(selectedWord, 1),
                                                    className: 'flex-1 bg-yellow-100 text-yellow-800 py-3 px-3 rounded text-sm font-medium hover:bg-yellow-200 transition-colors'
                                                }, 'ðŸ“ Learning'),
                                                createElement('button', {
                                                    onClick: () => updateWordLevel(selectedWord, 2),
                                                    className: 'flex-1 bg-green-100 text-green-800 py-3 px-3 rounded text-sm font-medium hover:bg-green-200 transition-colors'
                                                }, 'âœ… Known')
                                            )
                                        )
                                    ) : createElement('div', {
                                        className: `border rounded-lg p-6 text-center text-gray-500 sticky top-4 ${
                                            darkMode ? 'bg-gray-900 border-gray-700' : 'bg-gray-50'
                                        }`
                                    },
                                        createElement(MousePointer, { className: 'w-12 h-12 mx-auto mb-3 opacity-50' }),
                                        createElement('p', { className: 'text-sm sm:text-base' }, 'Tap any word in the text to see its translation and manage your vocabulary.')
                                    )
                                )
                            )
                        )
                    )
                )
            );
        };

        ReactDOM.render(React.createElement(GermanVocabTracker), document.getElementById('root'));
    </script>
</body>
</html>